<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DeplacementVehicules.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">4HWC Autonomous Car</a> &gt; <a href="index.source.html" class="el_package">com.autonomouscar.view</a> &gt; <span class="el_source">DeplacementVehicules.java</span></div><h1>DeplacementVehicules.java</h1><pre class="source lang-java linenums">package com.autonomouscar.view;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.Cursor;
import java.awt.Dimension;
import java.awt.FlowLayout;
import java.awt.Font;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.event.WindowEvent;
import java.util.ArrayList;
import java.util.List;

import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.border.Border;
import javax.swing.border.LineBorder;

import com.autonomouscar.model.AutonomousCar;
import com.autonomouscar.service.AutonomousCarService;
import com.autonomouscar.utils.Chronometre;

public class DeplacementVehicules extends JFrame {

<span class="nc" id="L28">	private DeplacementVehiculesPanneau4HWC container = new DeplacementVehiculesPanneau4HWC();</span>

<span class="nc" id="L30">	private String origine = &quot;&quot;;</span>

<span class="nc" id="L32">	private List&lt;AutonomousCar&gt; listeVehicules = new ArrayList&lt;&gt;();</span>

<span class="nc" id="L34">	private Border whiteBorder = new LineBorder(Color.WHITE, 1);</span>

<span class="nc" id="L36">	private int compteurVehicules = 0;</span>

<span class="nc" id="L38">	private Font policeCalibriLight = new Font(&quot;Calibri Light&quot;, Font.BOLD, 30);</span>

<span class="nc" id="L40">	private Font policeCalibri = new Font(&quot;Calibri&quot;, Font.BOLD, 30);</span>

<span class="nc" id="L42">	private Font policeAgencyFB = new Font(&quot;Agency FB&quot;, Font.BOLD, 30);</span>

<span class="nc" id="L44">	private Cursor cursor = new Cursor(Cursor.HAND_CURSOR);</span>

	public static final int ATTENTE = 1500;

<span class="nc" id="L48">	AutonomousCarService autonomousCarService = new AutonomousCarService();</span>

<span class="nc" id="L50">	public DeplacementVehicules() {</span>

<span class="nc" id="L52">		this.setTitle(&quot;4HWC AUTONOMOUS CAR : Déplacement des véhicules&quot;);</span>

<span class="nc" id="L54">		this.setSize(1000, 600);</span>

<span class="nc" id="L56">		this.setLocationRelativeTo(null);</span>

<span class="nc" id="L58">		this.setDefaultCloseOperation(JFrame.DO_NOTHING_ON_CLOSE);</span>

<span class="nc" id="L60">		this.addWindowListener(new java.awt.event.WindowAdapter() {</span>
			@Override
			public void windowClosing(WindowEvent e) {

<span class="nc" id="L64">				int Answer = JOptionPane.showConfirmDialog(null, &quot;Etes vous sûr(e) de quitter ?&quot;, &quot;Quitter&quot;,</span>
						JOptionPane.YES_NO_OPTION, JOptionPane.QUESTION_MESSAGE);
<span class="nc bnc" id="L66" title="All 2 branches missed.">				if (Answer == JOptionPane.YES_OPTION) {</span>
<span class="nc" id="L67">					System.exit(0);</span>
				}

<span class="nc" id="L70">			}</span>
		});

<span class="nc" id="L73">		this.setResizable(false);</span>

<span class="nc" id="L75">		this.setIconImage(Bienvenue4HWC.icon4HWC.getImage());</span>

<span class="nc" id="L77">		this.listeVehicules = ChargementDeplacementVehicules.listeVehicules;</span>

<span class="nc" id="L79">		this.origine = ChargementDeplacementVehicules.origine;</span>

<span class="nc" id="L81">		container.setLayout(new GridBagLayout());</span>

<span class="nc" id="L83">		PositionOrientationTempsReelPanneau4HWC positionOrientationTempsReel = new PositionOrientationTempsReelPanneau4HWC();</span>

<span class="nc" id="L85">		positionOrientationTempsReel.setPreferredSize(new Dimension(500, 70));</span>

		//////////////////////////

		/*
		 * Boucle pour chaque tondeuse
		 */

<span class="nc bnc" id="L93" title="All 2 branches missed.">		for (int i = 0; i &lt; this.listeVehicules.size(); i++) {</span>

<span class="nc" id="L95">			compteurVehicules++;</span>

			// Lancement du chronometre

<span class="nc" id="L99">			Chronometre.goChrono();</span>

<span class="nc" id="L101">			System.out.println(&quot;**************************************************************************&quot;);</span>

<span class="nc" id="L103">			System.out.println(&quot;Nombre de véhicules déployées : &quot; + this.listeVehicules.size());</span>

<span class="nc" id="L105">			System.out.println(&quot;Véhicule N° : &quot; + (i + 1));</span>

			// Début du parcours de la boucle d'indice I

			// Je récupère la tondeuse d'indice i

<span class="nc" id="L111">			AutonomousCar vehicule = this.listeVehicules.get(i);</span>

<span class="nc" id="L113">			String titleSuccesinit = &quot;Le véhicule N°&quot; + (i + 1) + &quot;/ &quot; + this.listeVehicules.size()</span>
					+ &quot; débute son parcours.&quot;;

<span class="nc" id="L116">			new DialogAvantParcours(null, titleSuccesinit, true, vehicule);</span>

<span class="nc" id="L118">			System.out.println(&quot;INIT&quot;);</span>

<span class="nc" id="L120">			System.out.println(&quot;POSITION XCOIN DROIT : &quot; + vehicule.getXCoinDroit() + &quot; / &quot; + &quot;POSITION YCOIN DROIT : &quot;</span>
<span class="nc" id="L121">					+ vehicule.getYCoinDroit() + &quot; / &quot; + &quot;POSITION XINIT : &quot; + vehicule.getXInitiale() + &quot; / &quot;</span>
<span class="nc" id="L122">					+ &quot;POSITION YINIT : &quot; + vehicule.getYInitiale() + &quot; / &quot; + &quot;O INIT : &quot;</span>
<span class="nc" id="L123">					+ vehicule.getOrientationInitiale());</span>

			// Je récupère le véhicule et ses différentes positions

<span class="nc" id="L127">			List&lt;AutonomousCar&gt; vehiculeAvecParametresDifferents = autonomousCarService.autonomousCarStates(vehicule);</span>

			// J'affiche le véhicule à différentes positions : Xactuelle;
			// Yactuelle et Oactuelle

<span class="nc bnc" id="L132" title="All 2 branches missed.">			for (int j = 0; j &lt; vehiculeAvecParametresDifferents.size(); j++)</span>

			{
<span class="nc" id="L135">				DeplacementVehiculesSurface bitume = new DeplacementVehiculesSurface();</span>

<span class="nc" id="L137">				bitume.setLayout(new GridBagLayout());</span>

<span class="nc" id="L139">				int xCD = vehiculeAvecParametresDifferents.get(j).getXCoinDroit();</span>

<span class="nc" id="L141">				int yCD = vehiculeAvecParametresDifferents.get(j).getYCoinDroit();</span>

<span class="nc" id="L143">				GridBagConstraints gbcBitume = new GridBagConstraints();</span>

<span class="nc" id="L145">				setDimensionsBitume(xCD, yCD, bitume);</span>

				/*
				 * Boucle pour Création de surfaces rectangulaires pour la surface
				 */

				// Positionnement de la case de départ du composant

<span class="nc" id="L153">				gbcBitume.gridx = 0;</span>

<span class="nc" id="L155">				gbcBitume.gridy = 0;</span>

				// Taille en hauteur et largeur

<span class="nc" id="L159">				gbcBitume.gridheight = 1;</span>

<span class="nc" id="L161">				gbcBitume.gridwidth = 1;</span>

				/* Positionnement sur la surface */

<span class="nc bnc" id="L165" title="All 2 branches missed.">				for (int posY = 0; posY &lt;= yCD; posY++) {</span>

<span class="nc bnc" id="L167" title="All 2 branches missed.">					for (int posX = 0; posX &lt;= xCD; posX++) {</span>

<span class="nc" id="L169">						JPanel surface = new JPanel();</span>
<span class="nc" id="L170">						surface.setPreferredSize(new Dimension(120, 72));</span>
<span class="nc" id="L171">						surface.setOpaque(false);</span>
<span class="nc" id="L172">						surface.setBorder(whiteBorder);</span>

<span class="nc" id="L174">						surface.setLayout(new BorderLayout());</span>

<span class="nc" id="L176">						bitume.add(surface, gbcBitume);</span>

<span class="nc" id="L178">						gbcBitume.gridx++;</span>

					} // posX

<span class="nc" id="L182">					gbcBitume.gridy++; // On passe à une autre ligne</span>

<span class="nc" id="L184">					gbcBitume.gridx = 0; // Je me place à la 1ère colonne</span>

				} // posY

				// fin du dessin des surfaces rectangulaires sur la surface

				// Affichage des différentes positions sur la surface

<span class="nc" id="L192">				affichageVehiculeSurBitume(gbcBitume, vehiculeAvecParametresDifferents.get(j), bitume);</span>

<span class="nc" id="L194">				GridBagConstraints gbc = new GridBagConstraints();</span>

<span class="nc" id="L196">				gbc.gridx = 0;</span>

<span class="nc" id="L198">				gbc.gridy = 0;</span>

<span class="nc" id="L200">				String textePositionOrientationInstantT = &quot;( &quot; + vehiculeAvecParametresDifferents.get(j).getXActuelle()</span>
<span class="nc" id="L201">						+ &quot; , &quot; + vehiculeAvecParametresDifferents.get(j).getYActuelle() + &quot; , &quot;</span>
<span class="nc" id="L202">						+ vehiculeAvecParametresDifferents.get(j).getOrientationActuelle() + &quot; )&quot;;</span>

<span class="nc" id="L204">				JLabel positionOrientationInstantT = new JLabel(textePositionOrientationInstantT);</span>

<span class="nc" id="L206">				positionOrientationInstantT.setFont(policeAgencyFB);</span>

<span class="nc" id="L208">				positionOrientationInstantT.setForeground(Color.WHITE);</span>

<span class="nc" id="L210">				positionOrientationTempsReel.setLayout(new FlowLayout());</span>

<span class="nc" id="L212">				positionOrientationTempsReel.add(positionOrientationInstantT);</span>

<span class="nc" id="L214">				container.add(positionOrientationTempsReel, gbc);</span>

<span class="nc" id="L216">				gbc.gridy = 1;</span>

<span class="nc" id="L218">				container.add(bitume, gbc);</span>

<span class="nc" id="L220">				this.setContentPane(container);</span>

<span class="nc" id="L222">				this.setVisible(true);</span>

				// Temps mis par le véhicule pour changer de position ou
				// d'orientation

				try {
<span class="nc" id="L228">					Thread.sleep(ATTENTE);</span>
<span class="nc" id="L229">				} catch (InterruptedException e) {</span>

<span class="nc" id="L231">					e.printStackTrace();</span>
<span class="nc" id="L232">				}</span>

<span class="nc" id="L234">				positionOrientationTempsReel.removeAll();</span>

<span class="nc" id="L236">				container.removeAll();</span>

			} // Boucle for j

			// Fin du parcours du véhicule d'indice I

			// Stop chrono

<span class="nc" id="L244">			Chronometre.stopChrono();</span>

<span class="nc" id="L246">			vehicule.setChronoFinale(Chronometre.getChrono());</span>

			// Communication de la position et de l'orientation finale

<span class="nc" id="L250">			vehicule.setXFinale(vehicule.getXActuelle());</span>

<span class="nc" id="L252">			vehicule.setYFinale(vehicule.getYActuelle());</span>

<span class="nc" id="L254">			vehicule.setOrientationFinale(vehicule.getOrientationActuelle());</span>

<span class="nc" id="L256">			System.out.println(&quot;CHRONO : &quot; + vehicule.getChronoFinale() + &quot; unités temporelles&quot;);</span>

<span class="nc" id="L258">			System.out.println(&quot;FIN&quot;);</span>

<span class="nc" id="L260">			System.out.println(&quot;POSITION X FINALE : &quot; + vehicule.getXFinale() + &quot; / POSITION Y FINALE : &quot;</span>
<span class="nc" id="L261">					+ vehicule.getYFinale() + &quot; / O FINALE : &quot; + vehicule.getOrientationFinale());</span>

<span class="nc" id="L263">			System.out.println(&quot;**************************************************************************&quot;);</span>

<span class="nc" id="L265">			String titleSuccess = &quot;Le véhicule N°&quot; + (i + 1) + &quot;/ &quot; + this.listeVehicules.size()</span>
					+ &quot; est bien arrivée à destination.&quot;;

<span class="nc" id="L268">			new DialogApresParcours(null, titleSuccess, true, vehicule);</span>

		} // Boucle for i

		// Redirection vers le menu dès que tous les véhicules ont effectué
		// leurs parcours

		// Initialisation des paramètres statiques du formulaire pour permettre
		// une meilleure saisie

<span class="nc bnc" id="L278" title="All 2 branches missed.">		if (compteurVehicules == this.listeVehicules.size()) {</span>

<span class="nc" id="L280">			redirectionVersMenu();</span>

		}

<span class="nc" id="L284">	} // Fin constructeur</span>

	private void redirectionVersMenu() {

<span class="nc bnc" id="L288" title="All 2 branches missed.">		if (this.origine.equals(&quot;paramètres&quot;)) {</span>

			// Si les véhicules proviennent du formulaire

<span class="nc" id="L292">			FormulaireVehicules.compteur = 1;</span>

<span class="nc" id="L294">			FormulaireVehicules.listeVehicules.clear();</span>

		}

<span class="nc" id="L298">		this.dispose();</span>

<span class="nc" id="L300">		new Menu4HWC();</span>

<span class="nc" id="L302">	}</span>

	private void setDimensionsBitume(int xCD, int yCD, DeplacementVehiculesSurface bitume) {

<span class="nc" id="L306">		int dimensionX = (xCD + 1) * 120;</span>

<span class="nc" id="L308">		int dimensionY = (yCD + 1) * 72;</span>

<span class="nc" id="L310">		bitume.setPreferredSize(new Dimension(dimensionX, dimensionY));</span>
<span class="nc" id="L311">	}</span>

	/*
	 * Mon repère est différent de celui de l'ordi donc il est important de
	 * convertir. On a le même axe des abscisses mais les axes des ordonnées ont des
	 * sens opposés.
	 * 
	 * L'axe y de l'ordi est descendant, le mien est ascendant
	 * 
	 * 0&lt;=x&lt;=xCD&lt;=5 0&lt;=y&lt;=yCD&lt;=5
	 */

	static int yComputerToYSurface(int y, int yCD) {

<span class="nc" id="L325">		return (yCD - y);</span>
	}

	static int ySurfaceToYComputer(int y, int yCD) {

<span class="nc" id="L330">		return (yCD - y);</span>
	}

	/*
	 * Cette fonction récupère les x;y et orientations actuelles et affiche le
	 * véhicule sur la surface
	 */

	private void affichageVehiculeSurBitume(GridBagConstraints gbc, AutonomousCar vehicule,
			DeplacementVehiculesSurface bitume) {

<span class="nc" id="L341">		DeplacementVehiculesSurfaceSens imageVehiculeActuelle = new DeplacementVehiculesSurfaceSens(</span>
<span class="nc" id="L342">				vehicule.getOrientationActuelle());</span>

<span class="nc" id="L344">		int xActuelle = vehicule.getXActuelle();</span>

<span class="nc" id="L346">		int yActuelle = vehicule.getYActuelle();</span>

<span class="nc" id="L348">		int yCD = vehicule.getYCoinDroit();</span>

<span class="nc" id="L350">		gbc.gridx = xActuelle;</span>

<span class="nc" id="L352">		gbc.gridy = DeplacementVehicules.ySurfaceToYComputer(yActuelle, yCD);</span>

<span class="nc" id="L354">		JPanel surface = new JPanel();</span>
<span class="nc" id="L355">		surface.setPreferredSize(new Dimension(120, 72));</span>
<span class="nc" id="L356">		surface.setOpaque(false);</span>
<span class="nc" id="L357">		surface.setBorder(whiteBorder);</span>

<span class="nc" id="L359">		surface.setLayout(new BorderLayout());</span>

<span class="nc" id="L361">		surface.add(imageVehiculeActuelle);</span>

<span class="nc" id="L363">		bitume.add(surface, gbc);</span>

<span class="nc" id="L365">		bitume.repaint();</span>

<span class="nc" id="L367">	}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.7.201606060606</span></div></body></html>